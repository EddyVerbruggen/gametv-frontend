<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=0"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>Game TV</title>
  <!-- NOTE: jqm loads the HEAD only once per session, so we need to include all css and js on every page (not only the first, because a reload of a page need to load all css/js as well) -->
  <link rel="stylesheet" href="js/lib/jquery.mobile-1.2.0/jquery.mobile-1.2.0.min.css"/>
  <link rel="stylesheet" href="js/lib/jquery.mobile-1.2.0/jquery.mobile.theme-1.2.0.min.css"/>
  <link rel="stylesheet" href="css/gametv.custom.css"/>
  <!--<link rel="stylesheet" href="css/index.css"/>-->
  <script src="js/lib/jquery.js"></script>
  <script src="js/gametv.custom.js"></script>
  <script src="js/lib/jquery.mobile-1.2.0/jquery.mobile-1.2.0.min.js"></script>
  <script src="phonegap.js"></script>
  <!--<script src="js/index.js"></script>-->
  <script type="text/javascript">
    $(document).ready(function() {
      loadVideos();
    });

    function loadVideos() {
      $.getJSON(getServiceURL("/video/all"))
          .success(function(data) {
            localStorage.setItem("videos", JSON.stringify(data));
            renderVideoList(data);
          })
          .error(function() {
            var cachedVideos = localStorage.getItem("videos");
            if (cachedVideos == null) {
              $(".feedback").html("Well, there was an error loading the videos from the server. Please try again later..");
            } else {
              $(".feedback").html("Failed to fetch latest videos, showing the last known list.");
            }
            renderVideoList(JSON.parse(cachedVideos));
          })
    }

    function renderVideoList(data) {
      var html = '';
      $.each(data, function(idx, video) {
        //todo: iCanHaz?
        html += '' +
            '<li>' +
            '  <a href="#">' +
            '    <img src="' + video.imageurl + '" alt="' + video.title + '"/>' +
            '    <h3>'+video.title+'</h3>' +
            '  </a>' +
            '  <a data-transition="pop" data-position-to="window" data-rel="popup" href="'+video.videourl+'">Bekijk video</a>' +
            '</li>';
      });
      $("#videoList").append(html);
      $("#videoList").listview('refresh');
    }
  </script>
</head>
<body>

<!-- PAGE 1 -->
<div data-role="page" id="videosources">

  <div data-role="header">
  	<h1>Video bronnen</h1>
  </div>

  <div class="feedback"></div>

  <div data-role="content">
    <div class="content-primary">
      <ul id="videosourceList" data-role="listview" data-inset="false">
        <li>
          <a href="#videos">
            <img src="img/videosources/gamekings.jpg" height="84px"/>
            <h3>GameKings</h3>
            <p>Reviews, nieuws en lolligheid</p>
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- PAGE 2 -->
<div data-role="page" id="videos" data-add-back-btn="true">

  <div data-role="header">
  	<h1>GameKings</h1>
  </div>

  <div class="feedback"></div>

  <div data-role="content">
    <div class="content-primary">
      <ul id="videoList" data-role="listview" data-inset="false" data-split-theme="d" data-split-icon="arrow-r"></ul>
    </div>
  </div>

</div>
</body>
</html>
